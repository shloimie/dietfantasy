// prisma/schema.prisma
datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

generator client {
  provider = "prisma-client-js"
}

/**
 * ──────────────────────────────────────────────────────────
 * EXISTING TABLES (unchanged from your project)
 * ──────────────────────────────────────────────────────────
 */

model User {
  id       Int     @id @default(autoincrement())
  first    String
  last     String
  address  String
  apt      String?
  city     String
  dislikes String?
  county   String?
  zip      String?
  state    String?
  phone    String?
  medicaid Boolean @default(false)
  paused   Boolean @default(false)
  complex  Boolean @default(false)

  schedule Schedule?

  latitude   Float?
  longitude  Float?
  geocodedAt DateTime?
  lat        Float?    @db.DoublePrecision
  lng        Float?    @db.DoublePrecision

  @@map("User") // maps Prisma model User -> table public."User"
}

model Schedule {
  id        Int     @id @default(autoincrement())
  userId    Int     @unique @map("userId")
  monday    Boolean @default(true)
  tuesday   Boolean @default(true)
  wednesday Boolean @default(true)
  thursday  Boolean @default(true)
  friday    Boolean @default(true)
  saturday  Boolean @default(true)
  sunday    Boolean @default(true)

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("Schedule")
}

model CityColor {
  id         Int      @id @default(autoincrement())
  city       String   @unique
  color      String
  updated_at DateTime @default(now())

  @@map("CityColor")
}

/**
 * ──────────────────────────────────────────────────────────
 * NEW SEPARATED TABLES (no route relational table)
 * Drivers reference their stops by JSON array of stop IDs.
 * Stops are independent rows (optionally mirror assignedDriverId).
 * ──────────────────────────────────────────────────────────
 */

model Driver {
  id        Int      @id @default(autoincrement())
  day       String
  name      String
  color     String
  stopIds   Json // array<int> of Stop.id (no FK)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([day])
  @@map("Driver")
}

model Stop {
  id               Int      @id @default(autoincrement())
  day              String
  userId           Int?
  order            Int?
  name             String
  address          String
  apt              String?
  city             String
  state            String
  zip              String
  phone            String?
  dislikes         String?
  lat              Float?
  lng              Float?
  completed        Boolean  @default(false)
  proofUrl         String?
  assignedDriverId Int? // convenience mirror only; NOT a relation
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@index([day])
  @@map("Stop")
}

/**
 * ──────────────────────────────────────────────────────────
 * DEPRECATED (no longer used):
 * - DriverRoute
 * - RoutePlan
 * Remove/ignore in DB if present.
 * ──────────────────────────────────────────────────────────
 */
